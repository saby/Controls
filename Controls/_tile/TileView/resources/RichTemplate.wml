<ws:template name="imageTemplate">
   <ws:if data="{{imagePosition === 'top' && imageViewMode === 'rectangle' && imageProportion}}">
      <div class="controls-TileView__image_resizer" style="padding-top: {{100 * imageProportion}}%"></div>
   </ws:if>
   <svg role="image"
        xmlns="http://www.w3.org/2000/svg"
        height="100%"
        width="100%"
        class="controls-TileView__richTemplate_image
               controls-TileView__richTemplate_image_viewMode_{{imageViewMode}}
               {{!imageProportion || imageViewMode !== 'rectangle' || imagePosition !== 'top' ? 'controls-TileView__richTemplate_image_size_' + imageSize + '_position_' + imagePosition + '_viewMode_' + imageViewMode + '_theme-' + theme +
               ' controls-TileView__richTemplate_image_size_' + imageSize + '_position_' + (imagePosition !== 'top' ? 'vertical' : 'top') + '_theme-' + theme : ''}}"
        preserveAspectRatio="xMidYMid {{imageFit === 'cover' ? 'slice' : 'meet'}}">
      <image preserveAspectRatio="xMidYMid {{imageFit === 'cover' ? 'slice' : 'meet'}}" height="100%" width="100%" xlink:href="{{itemData.imageData.url}}"></image>
   </svg>
   <ws:if data="{{imageEffect === 'gradient' && imageViewMode === 'rectangle' && imagePosition === 'top'}}">
      <div class="controls-TileView__richTemplate_image_effect_gradient"
           style="{{'background: linear-gradient(to bottom, rgba(255, 255, 255, 0) 0%,' + (gradientColor || '#ffffff') + ' 100%);'}}"></div>
   </ws:if>
</ws:template>

<ws:template name="itemContentTemplate">
   <div class="controls-TileView__richTemplate_itemContent controls-TileView__richTemplate_itemContent_theme-{{theme}} ws-ellipsis"
        style="background-color: {{(!imageViewMode || imageViewMode === 'rectangle') && imagePosition !== 'left' && imagePosition !== 'right' ? gradientColor || '#FFF' : ''}}">
      <div class="controls-TileView__richTemplate_title
                  {{titleLines > 1 ? 'controls-TileView__text_ellipsis_multiLine' : 'ws-ellipsis'}}
                  controls-TileView__richTemplate_title_theme-{{theme}}
                  controls-fontsize-{{itemData.dispItem.isNode() ? '4xl' : 'xl'}}_theme-{{theme}}
                  controls-text-{{titleColorStyle || 'default'}}_theme-{{theme}}
                  controls-fontweight-bold"
           title="{{itemData.item[itemData.displayProperty]}}"
           style="-webkit-line-clamp: {{titleLines || 1}};">{{itemData.item[itemData.displayProperty]}}</div>
      <ws:if data="{{description && descriptionLines !== 0}}">
         <div class="controls-TileView__richTemplate_description
                     {{descriptionLines > 1 ? 'controls-TileView__text_ellipsis_multiLine' : 'ws-ellipsis'}}
                     controls-TileView__richTemplate_description_theme-{{theme}}" title="{{description}}"
              style="-webkit-line-clamp: {{descriptionLines || 1}};">{{description}}</div>
      </ws:if>
      <ws:if data="{{footerTemplate}}">
         <ws:partial template="{{footerTemplate}}"
                     itemData="{{itemData}}"/>
      </ws:if>
   </div>
</ws:template>

<ws:template name="richTemplateContent">
   <div class="controls-TileView__richTemplate controls-TileView__richTemplate_imagePosition_{{imagePosition || 'top'}}">
      <ws:if data="{{imageViewMode !== 'none'}}">
         <div class="controls-TileView__richTemplate_imageWrapper
                     {{imageViewMode !== 'rectangle' && (!imagePosition || imagePosition === 'top') && itemData.getTileSizes ? 'controls-TileView__richTemplate_imageWrapper__ellipse_proportion'}}
                     controls-TileView_richTemplate_image_spacing_viewMode_{{imageViewMode || 'rectangle'}}_theme-{{theme}}">
            <!-- TODO костыль для imageSize, убрать https://online.sbis.ru/opendoc.html?guid=2986407e-574b-476e-861e-5c14099eab22 -->
            <ws:partial template="imageTemplate"
                        imagePosition="{{imagePosition || 'top'}}"
                        imageViewMode="{{imageViewMode || 'rectangle'}}"
                        imageSize="{{itemData.getTileSizes && imageViewMode !== 'rectangle' ? 'xl' : (imageSize || 's')}}"
                        imageFit="{{imageFit || 'cover'}}"
                        imageProportion="{{imageProportion ? itemData.getImageProportion(imageProportion) : null}}"/>
         </div>
      </ws:if>
      <ws:partial template="itemContentTemplate"/>
   </div>
</ws:template>

<ws:partial template="wml!Controls/_tile/TreeTileView/DefaultItemTpl"
            attr:class="controls-TileView__richTemplate_item"
            itemActionsClass="controls-TileView__richTemplate_itemActions controls-TileView__itemActions_topRight controls-TileView__richTemplate_itemActions_theme-{{theme}}"
            itemActionsPadding="null"
            highlightOnHover="{{false}}"
            itemWidth="{{itemData.getTileSizes && itemData.getTileSizes(_options.itemData.tileSize, _options.imagePosition, _options.imageViewMode).width}}"
            folderWidth="{{itemData.getTileSizes && itemData.getTileSizes(_options.itemData.tileSize, _options.imagePosition, _options.imageViewMode).width}}"
            staticHeight="{{true}}"
            height="auto"
            scope="{{_options}}">
   <ws:contentTemplate>
      <ws:partial template="richTemplateContent"/>
   </ws:contentTemplate>
   <ws:nodeContentTemplate>
      <ws:partial template="richTemplateContent"/>
   </ws:nodeContentTemplate>
</ws:partial>
